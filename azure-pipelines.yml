trigger:
  - master

stages:
  - stage: Linux
    pool:
      vmImage: 'ubuntu-18.04'
    dependsOn: []
    jobs:
      - job:
        steps:
          - task: Gradle@2
            inputs:
              workingDirectory: ''
              gradleWrapperFile: 'gradlew'
              javaHomeOption: 'JDKVersion'
              jdkVersionOption: '1.8'
              jdkArchitectureOption: 'x64'
              publishJUnitResults: false
              tasks: '-Pversion=0.0.0-SNAPSHOT clean check publishToMavenLocal'

          - task: Gradle@2
            inputs:
              workingDirectory: 'demo-project'
              gradleWrapperFile: 'gradlew'
              javaHomeOption: 'JDKVersion'
              jdkVersionOption: '1.8'
              jdkArchitectureOption: 'x64'
              publishJUnitResults: false
              tasks: 'clean check --stacktrace'

  - stage: MacOS
    pool:
      vmImage: 'macos-10.14'
    dependsOn: []
    jobs:
      - job:
        steps:
          - task: Gradle@2
            inputs:
              workingDirectory: ''
              gradleWrapperFile: 'gradlew'
              javaHomeOption: 'JDKVersion'
              jdkVersionOption: '1.8'
              jdkArchitectureOption: 'x64'
              publishJUnitResults: false
              tasks: 'clean macosX64Test iosX64Test'

          - task: Gradle@2
            inputs:
              workingDirectory: ''
              gradleWrapperFile: 'gradlew'
              javaHomeOption: 'JDKVersion'
              jdkVersionOption: '1.8'
              jdkArchitectureOption: 'x64'
              publishJUnitResults: false
              tasks: '-Pversion=0.0.0-SNAPSHOT publishMetadataPublicationToMavenLocal publishKotlinMultiplatformPublicationToMavenLocal publishJvmPublicationToMavenLocal publishMacosX64PublicationToMavenLocal publishIosX64PublicationToMavenLocal publishIosArm64PublicationToMavenLocal'

          - task: Gradle@2
            inputs:
              workingDirectory: ''
              gradleWrapperFile: 'gradlew'
              javaHomeOption: 'JDKVersion'
              jdkVersionOption: '1.8'
              jdkArchitectureOption: 'x64'
              publishJUnitResults: false
              tasks: '-Pversion=0.0.0-SNAPSHOT mmock-ksp-plugin:publishToMavenLocal mmock-gradle-plugin:publishToMavenLocal'

          - task: Gradle@2
            inputs:
              workingDirectory: 'demo-project'
              gradleWrapperFile: 'gradlew'
              javaHomeOption: 'JDKVersion'
              jdkVersionOption: '1.8'
              jdkArchitectureOption: 'x64'
              publishJUnitResults: false
              tasks: 'clean macosX64Test iosX64Test'

  - stage: Windows
    pool:
      vmImage: 'vs2017-win2016'
    dependsOn: []
    jobs:
      - job:
        steps:
          - task: Gradle@2
            inputs:
              workingDirectory: ''
              gradleWrapperFile: 'gradlew'
              javaHomeOption: 'JDKVersion'
              jdkVersionOption: '1.8'
              jdkArchitectureOption: 'x64'
              publishJUnitResults: false
              tasks: 'clean mingwX64Test'

          - task: Gradle@2
            inputs:
              workingDirectory: ''
              gradleWrapperFile: 'gradlew'
              javaHomeOption: 'JDKVersion'
              jdkVersionOption: '1.8'
              jdkArchitectureOption: 'x64'
              publishJUnitResults: false
              tasks: '-Pversion=0.0.0-SNAPSHOT publishMetadataPublicationToMavenLocal publishJvmPublicationToMavenLocal publishKotlinMultiplatformPublicationToMavenLocal publishMingwX64PublicationToMavenLocal'

          - task: Gradle@2
            inputs:
              workingDirectory: ''
              gradleWrapperFile: 'gradlew'
              javaHomeOption: 'JDKVersion'
              jdkVersionOption: '1.8'
              jdkArchitectureOption: 'x64'
              publishJUnitResults: false
              tasks: '-Pversion=0.0.0-SNAPSHOT mmock-ksp-plugin:publishToMavenLocal mmock-gradle-plugin:publishToMavenLocal'

          - task: Gradle@2
            inputs:
              workingDirectory: 'demo-project'
              gradleWrapperFile: 'gradlew'
              javaHomeOption: 'JDKVersion'
              jdkVersionOption: '1.8'
              jdkArchitectureOption: 'x64'
              publishJUnitResults: false
              tasks: 'clean mingwX64Test'